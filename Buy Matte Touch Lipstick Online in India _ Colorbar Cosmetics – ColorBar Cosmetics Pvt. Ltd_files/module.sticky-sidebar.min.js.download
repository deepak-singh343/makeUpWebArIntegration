(function(l){function n(){this.settings={offset:15,min_height_diff:100};this.current={scroll:0};this.load()}n.prototype=l.extend({},n.prototype,{load:function(){var e=this,f=l(".js-popup").find(".popup-quick-view");this._getSidebars();theme.Global.responsiveHandler({namespace:".sticky-sidebar",element:$window,on_desktop:!0,is_mobile_prop:"is_mobile_md",is_desktop_prop:"is_desktop_md",onbindload:!0,onunbind_func:function(){l.each(e.sidebars,function(b,m){e._resetSidebar(m)})},events:{"theme.resize.sticky-sidebar scroll.sticky-sidebar sticky-sidebar.update":function(){e.update()}}});
f.length&&theme.Global.responsiveHandler({namespace:".sticky-sidebar",element:l(".js-popup"),on_desktop:!0,is_mobile_prop:"is_mobile_md",is_desktop_prop:"is_desktop_md",onbindload:!0,events:{"scroll.sticky-sidebar":function(){e.update(null,-1*f[0].getBoundingClientRect().top+31)}}})},reload:function(){this._getSidebars();this.update()},_getSidebars:function(){var e=this;this.sidebars=[];l(".js-sticky-sidebar").each(function(){var f=l(this),b=f.find("[data-js-sticky-sidebar-body]");e.sidebars.push({$elem:f,
$parent:f.parent(),$body:b,state:null,disable_offsets:b[0].hasAttribute("data-js-disable-offsets")?!0:!1})})},_resetSidebar:function(e){e.$elem.removeClass("sidebar-fixed-bottom sidebar-static-bottom sidebar-fixed-top sidebar-offset-top");e.$body.removeAttr("style")},_startAction:function(e,f,b){f.state!==e&&(b(),f.state=e)},update:function(e,f){if(theme.current.is_desktop_md){if("listener-enable"===e)this.fixed=!0;else if("listener-disable"===e){this.fixed=null;return}f=f?f:window.scrollY;var b=
this,m=document.querySelector("sticky-header"),g=m&&m.getStickyHeight?Math.ceil(m.getStickyHeight()):0,k=theme.ProductFootbar&&theme.ProductFootbar.$footbar?Math.ceil(theme.ProductFootbar.getFootbarHeight()):0;l.each(this.sidebars,function(p,a){var c=a.$parent[0].getBoundingClientRect(),d=a.$body[0].getBoundingClientRect(),h=null;d.height+b.settings.min_height_diff>=c.height||a.$elem.hasClass("sticky-sidebar-xl")&&"xl"!==theme.current.bp||a.$elem.hasClass("sticky-sidebar-lg")&&!theme.current.is_desktop?
(b._startAction(1,a,function(){b._resetSidebar(a)}),a.parent_pos=c,a.body_pos=d):(a.disable_offsets&&(k=g=0),"listener-enable"===e?(a.$elem.addClass("sidebar-fixed-top"),a.$elem.removeClass("sidebar-offset-top sidebar-fixed-bottom sidebar-static-bottom"),a.$body.css({width:a.$elem.width()+"px",top:d.top+"px",bottom:"","margin-top":""}),a.state=null,a.parent_pos=c,a.body_pos=d):"listener-process"===e?(d.height>=c.height?b._startAction(1,a,function(){b._resetSidebar(a)}):c.height>a.parent_pos.height&&
c.bottom>b.settings.offset+g&&d.top<b.settings.offset+g?(c.bottom<theme.current.height-b.settings.offset-k?h=c.height-d.height:d.top>c.top&&a.parent_pos.bottom<theme.current.height&&(h=c.height-d.height-(c.bottom-theme.current.height)-b.settings.offset-k),h&&0<h&&(a.$elem.removeClass("sidebar-fixed-top sidebar-static-bottom").addClass("sidebar-offset-top"),a.$body.css({width:"",top:"","margin-top":h+"px"}))):c.height<a.parent_pos.height?a.$elem.hasClass("sidebar-fixed-top")&&Math.ceil(c.bottom)<Math.floor(d.bottom)&&
(a.$elem.removeClass("sidebar-fixed-top sidebar-offset-top").addClass("sidebar-static-bottom"),a.$body.removeAttr("style")):d.height!==a.body_pos.height&&(c.bottom<theme.current.height-b.settings.offset-k?d.top!==c.top&&a.$body.css({top:-1*(d.height-theme.current.height)-(theme.current.height-c.bottom)+"px"}):d.bottom<theme.current.height?d.height>theme.current.height-2*b.settings.offset-g-k?a.$body.css({top:-1*(d.height-theme.current.height)-b.settings.offset-k+"px"}):c.top<b.settings.offset+g&&
a.$body.css({top:b.settings.offset+g+"px"}):d.bottom>c.bottom&&a.$body.css({top:-1*(d.height-theme.current.height)-(theme.current.height-c.bottom)+"px"})),a.body_pos=d,a.parent_pos=c):b.fixed||(d.height>theme.current.height-2*b.settings.offset-g-k?f>b.current.scroll?Math.floor(d.bottom)>Math.ceil(theme.current.height-b.settings.offset-k)?b._startAction(2,a,function(){c.top<b.settings.offset+g&&!a.$elem.hasClass("sidebar-offset-top")&&(h=c.top-d.top,a.$elem.addClass("sidebar-offset-top"));a.$elem.removeClass("sidebar-fixed-bottom sidebar-static-bottom sidebar-fixed-top");
a.$body.css({width:"",bottom:"",top:""});h&&(a.$body.css({"margin-top":-1*h+"px"}),h=null)}):Math.floor(c.bottom)>Math.ceil(theme.current.height-b.settings.offset-k)?b._startAction(3,a,function(){a.$body.css({width:a.$elem.width()+"px",bottom:b.settings.offset+k+"px",top:"","margin-top":""});a.$elem.removeClass("sidebar-static-bottom sidebar-fixed-top sidebar-offset-top").addClass("sidebar-fixed-bottom")}):b._startAction(4,a,function(){a.$elem.removeClass("sidebar-fixed-bottom sidebar-fixed-top sidebar-offset-top").addClass("sidebar-static-bottom");
a.$body.removeAttr("style")}):f<b.current.scroll&&(d.top<b.settings.offset+g?b._startAction(5,a,function(){c.top<b.settings.offset+g&&!a.$elem.hasClass("sidebar-offset-top")&&(h=c.top-d.top,a.$elem.addClass("sidebar-offset-top"));a.$elem.removeClass("sidebar-fixed-top sidebar-fixed-bottom");a.$body.css({width:"",top:"",bottom:""});h&&(a.$body.css({"margin-top":-1*h+"px"}),h=null)}):c.top<b.settings.offset+g?b._startAction(6,a,function(){a.$body.css({width:a.$elem.width()+"px",top:b.settings.offset+
g+"px",bottom:"","margin-top":""});a.$elem.removeClass("sidebar-offset-top sidebar-fixed-bottom sidebar-static-bottom").addClass("sidebar-fixed-top")}):b._startAction(1,a,function(){b._resetSidebar(a)})):c.top<b.settings.offset+g?d.height<c.bottom-b.settings.offset-g?b._startAction(7,a,function(){a.$body.css({width:a.$elem.width()+"px",top:b.settings.offset+g+"px",bottom:"","margin-top":""});a.$elem.removeClass("sidebar-static-bottom sidebar-fixed-bottom sidebar-offset-top").addClass("sidebar-fixed-top")}):
b._startAction(8,a,function(){a.$elem.removeClass("sidebar-fixed-top sidebar-offset-top sidebar-fixed-bottom").addClass("sidebar-static-bottom");a.$body.removeAttr("style")}):b._startAction(1,a,function(){b._resetSidebar(a)})))});this.current.scroll=f}}});theme.AssetsLoader.onPageLoaded(function(){theme.StickySidebar=new n})})(jQueryTheme);
